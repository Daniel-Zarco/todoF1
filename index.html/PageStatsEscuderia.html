<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Estadísticas de la Escudería</title>
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/PageStatsEscuderia.css">
</head>
<body>
  <h1 id="titulo">Estadísticas de la Escudería</h1>
  <div id="stats-container"></div>
  <a href="#" id="btn-volver" class="back-button">← Volver a Escuderías</a>

  <script>
    const params = new URLSearchParams(window.location.search);
    const escuderia = params.get("escuderia");
    const year = params.get("year");

    document.getElementById("titulo").textContent = `Estadísticas de ${escuderia}`;

    const container = document.getElementById("stats-container");

    fetch(`https://ergast.com/api/f1/${year}/constructors/${encodeURIComponent(escuderia)}/results.json?limit=1000`)
      .then(response => response.json())
      .then(data => {
        const races = data.MRData.RaceTable.Races;

        // ✅ Si no hay resultados:
        if (races.length === 0) {
          container.innerHTML = `<div class="info-block">
            <span class="label">No hay información disponible para la escudería "${escuderia}" en el año ${year}.</span>
          </div>`;
          return;
        }

        let totalCarreras = races.length;
        let victorias = 0;
        let podios = 0;
        let nacionalidad = "";
        let totalPuntos = 0;
        let pilotos = new Set();
        let posiciones = [];

        races.forEach(race => {
          race.Results.forEach(result => {
            nacionalidad = result.Constructor.nationality;
            pilotos.add(`${result.Driver.givenName} ${result.Driver.familyName}`);
            totalPuntos += parseFloat(result.points);
            const pos = parseInt(result.position);
            if (pos === 1) victorias++;
            if (pos <= 3) podios++;
            posiciones.push(pos);
          });
        });

        const posMedia = posiciones.length > 0 ? (posiciones.reduce((a, b) => a + b, 0) / posiciones.length).toFixed(2) : "N/A";

        const stats = [
          { label: "Nacionalidad", value: nacionalidad || "N/A" },
          { label: "Carreras Disputadas", value: totalCarreras },
          { label: "Victorias", value: victorias },
          { label: "Podios", value: podios },
          { label: "Total de Puntos", value: totalPuntos },
          { label: "Posición Media", value: posMedia },
          { label: "Pilotos ese año", value: Array.from(pilotos).join(", ") },
        ];

        stats.forEach(stat => {
          const block = document.createElement('div');
          block.classList.add('info-block');
          block.innerHTML = `
            <span class="label">${stat.label}:</span>
            <span class="value">${stat.value}</span>
          `;
          container.appendChild(block);
        });
      })
      .catch(error => {
        console.error(error);
        container.innerHTML = '<p>Error al cargar las estadísticas de la escudería.</p>';
      });

    document.getElementById("btn-volver").addEventListener("click", e => {
      e.preventDefault();
      window.history.back();
    });
  </script>
</body>
</html>


